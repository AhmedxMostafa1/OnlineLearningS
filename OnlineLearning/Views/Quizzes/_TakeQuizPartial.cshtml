@model List<OnlineLearning.Models.Quiz>

<div class="alert alert-info">
    <div class="d-flex align-items-center">
        <i class="bi bi-info-circle-fill me-2"></i>
        <div>
            <strong>Quiz Instructions:</strong>
            <ul class="mb-0 mt-1">
                <li>Read each question carefully</li>
                <li>Select the best answer for each question</li>
                <li>You can review your answers before submitting</li>
                <li>Once submitted, you cannot change your answers</li>
            </ul>
        </div>
    </div>
</div>

<form asp-action="SubmitQuiz" asp-route-moduleId="@ViewBag.ModuleId" method="post">
    @Html.AntiForgeryToken()

    @for (int i = 0; i < Model.Count; i++)
    {
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light">
                <h6 class="mb-0">
                    <i class="bi bi-question-circle text-primary"></i>
                    Question @(i + 1) of @Model.Count
                </h6>
            </div>
            <div class="card-body">
                <h6 class="card-title">@Model[i].Question</h6>

                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio"
                           name="answers[@Model[i].QuizId].Value"
                           value="A"
                           id="q@(Model[i].QuizId)_a"
                           required>
                    <input type="hidden" name="answers[@Model[i].QuizId].Key" value="@Model[i].QuizId" />
                    <label class="form-check-label" for="q@(Model[i].QuizId)_a">
                        <strong>A)</strong> @Model[i].OptionA
                    </label>
                </div>

                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio"
                           name="answers[@Model[i].QuizId].Value"
                           value="B"
                           id="q@(Model[i].QuizId)_b"
                           required>
                    <input type="hidden" name="answers[@Model[i].QuizId].Key" value="@Model[i].QuizId" />
                    <label class="form-check-label" for="q@(Model[i].QuizId)_b">
                        <strong>B)</strong> @Model[i].OptionB
                    </label>
                </div>

                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio"
                           name="answers[@Model[i].QuizId].Value"
                           value="C"
                           id="q@(Model[i].QuizId)_c"
                           required>
                    <input type="hidden" name="answers[@Model[i].QuizId].Key" value="@Model[i].QuizId" />
                    <label class="form-check-label" for="q@(Model[i].QuizId)_c">
                        <strong>C)</strong> @Model[i].OptionC
                    </label>
                </div>

                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio"
                           name="answers[@Model[i].QuizId].Value"
                           value="D"
                           id="q@(Model[i].QuizId)_d"
                           required>
                    <input type="hidden" name="answers[@Model[i].QuizId].Key" value="@Model[i].QuizId" />
                    <label class="form-check-label" for="q@(Model[i].QuizId)_d">
                        <strong>D)</strong> @Model[i].OptionB
                    </label>
                </div>
                </div>
            </div>
        
    }

    <div class="d-flex justify-content-between align-items-center mt-4">
        <div>
            <span class="text-muted">
                <i class="bi bi-clock"></i> Take your time to review all questions
            </span>
        </div>
        <div>
            <button type="button" class="btn btn-secondary me-2" onclick="reviewAnswers()">
                <i class="bi bi-search"></i> Review Answers
            </button>
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="bi bi-send"></i> Submit Quiz
            </button>
        </div>
    </div>
</form>

<script>
    function reviewAnswers() {
        const form = document.querySelector('form');
        const formData = new FormData(form);
        let review = "Quiz Review:\n\n";
        let answeredCount = 0;

        // Count answered questions
        for (let [key, value] of formData.entries()) {
            if (key.startsWith('answers[')) {
                answeredCount++;
                const questionNum = answeredCount;
                review += `Question ${questionNum}: Option ${value}\n`;
            }
        }

        const totalQuestions = @Model.Count;

        if (answeredCount < totalQuestions) {
            review += `\nWarning: You have only answered ${answeredCount} out of ${totalQuestions} questions.`;
        } else {
            review += `\nAll ${totalQuestions} questions have been answered.`;
        }

        alert(review);
    }

    // Confirm before submitting
    document.querySelector('form').addEventListener('submit', function (e) {
        const form = e.target;
        const formData = new FormData(form);
        let answeredCount = 0;

        for (let [key, value] of formData.entries()) {
            if (key.startsWith('answers[')) {
                answeredCount++;
            }
        }

        const totalQuestions = @Model.Count;

        if (answeredCount < totalQuestions) {
            if (!confirm(`You have only answered ${answeredCount} out of ${totalQuestions} questions. Do you want to submit anyway?`)) {
                e.preventDefault();
                return false;
            }
        } else {
            if (!confirm('Are you sure you want to submit your quiz? You cannot change your answers after submission.')) {
                e.preventDefault();
                return false;
            }
        }
    });
</script>